(function(){var u=this,g=u.Backbone,s=[],nt=s.push,c=s.slice,tt=s.splice,t,n,f,e,v,y,k,d,h;t=typeof exports!="undefined"?exports:u.Backbone={},t.VERSION="0.9.10",n=u._,n||typeof require=="undefined"||(n=require("underscore")),t.$=u.jQuery||u.Zepto||u.ender,t.noConflict=function(){return u.Backbone=g,this},t.emulateHTTP=!1,t.emulateJSON=!1;var l=/\s+/,o=function(n,t,i,r){var f,e,u,o;if(!i)return!0;if(typeof i=="object")for(f in i)n[t].apply(n,[f,i[f]].concat(r));else if(l.test(i))for(e=i.split(l),u=0,o=e.length;u<o;u++)n[t].apply(n,[e[u]].concat(r));else return!0},a=function(n,t){var i,r=-1,u=n.length;switch(t.length){case 0:while(++r<u)(i=n[r]).callback.call(i.ctx);return;case 1:while(++r<u)(i=n[r]).callback.call(i.ctx,t[0]);return;case 2:while(++r<u)(i=n[r]).callback.call(i.ctx,t[0],t[1]);return;case 3:while(++r<u)(i=n[r]).callback.call(i.ctx,t[0],t[1],t[2]);return;default:while(++r<u)(i=n[r]).callback.apply(i.ctx,t)}},i=t.Events={on:function(n,t,i){if(!(o(this,"on",n,[t,i])&&t))return this;this._events||(this._events={});var r=this._events[n]||(this._events[n]=[]);return r.push({callback:t,context:i,ctx:i||this}),this},once:function(t,i,r){if(!(o(this,"once",t,[i,r])&&i))return this;var f=this,u=n.once(function(){f.off(t,u),i.apply(this,arguments)});u._callback=i;this.on(t,u,r);return this},off:function(t,i,r){var s,u,h,c,f,l,e,a;if(!this._events||!o(this,"off",t,[i,r]))return this;if(!t&&!i&&!r)return this._events={},this;for(c=t?[t]:n.keys(this._events),f=0,l=c.length;f<l;f++)if(t=c[f],s=this._events[t]){if(h=[],i||r)for(e=0,a=s.length;e<a;e++)u=s[e],(i&&i!==u.callback&&i!==u.callback._callback||r&&r!==u.context)&&h.push(u);this._events[t]=h}return this},trigger:function(n){var t,i,r;return this._events?(t=c.call(arguments,1),!o(this,"trigger",n,t))?this:(i=this._events[n],r=this._events.all,i&&a(i,t),r&&a(r,arguments),this):this},listenTo:function(t,i,r){var u=this._listeners||(this._listeners={}),f=t._listenerId||(t._listenerId=n.uniqueId("l"));u[f]=t;t.on(i,typeof i=="object"?this:r,this);return this},stopListening:function(n,t,i){var r=this._listeners,u;if(r){if(n)n.off(t,typeof t=="object"?this:i,this),t||i||delete r[n._listenerId];else{typeof t=="object"&&(i=this);for(u in r)r[u].off(t,i,this);this._listeners={}}return this}}};i.bind=i.on,i.unbind=i.off,n.extend(t,i),f=t.Model=function(t,i){var u,r=t||{};this.cid=n.uniqueId("c"),this.attributes={},i&&i.collection&&(this.collection=i.collection),i&&i.parse&&(r=this.parse(r,i)||{}),(u=n.result(this,"defaults"))&&(r=n.defaults({},r,u)),this.set(r,i),this.changed={},this.initialize.apply(this,arguments)},n.extend(f.prototype,i,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(n){return this.attributes[n]},escape:function(t){return n.escape(this.get(t))},has:function(n){return this.get(n)!=null},set:function(t,i,r){var u,f,l,e,h,c,a,o,s,v;if(t==null)return this;if(typeof t=="object"?(f=t,r=i):(f={})[t]=i,r||(r={}),!this._validate(f,r))return!1;l=r.unset,h=r.silent,e=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=n.clone(this.attributes),this.changed={}),o=this.attributes,a=this._previousAttributes,this.idAttribute in f&&(this.id=f[this.idAttribute]);for(u in f)i=f[u],n.isEqual(o[u],i)||e.push(u),n.isEqual(a[u],i)?delete this.changed[u]:this.changed[u]=i,l?delete o[u]:o[u]=i;if(!h)for(e.length&&(this._pending=!0),s=0,v=e.length;s<v;s++)this.trigger("change:"+e[s],this,o[e[s]],r);if(c)return this;if(!h)while(this._pending)this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(t,i){return this.set(t,void 0,n.extend({},i,{unset:!0}))},clear:function(t){var i={},r;for(r in this.attributes)i[r]=void 0;return this.set(i,n.extend({},t,{unset:!0}))},hasChanged:function(t){return t==null?!n.isEmpty(this.changed):n.has(this.changed,t)},changedAttributes:function(t){var u,i,f,r;if(!t)return this.hasChanged()?n.clone(this.changed):!1;i=!1,f=this._changing?this._previousAttributes:this.attributes;for(r in t)n.isEqual(f[r],u=t[r])||((i||(i={}))[r]=u);return i},previous:function(n){return n==null||!this._previousAttributes?null:this._previousAttributes[n]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(t){t=t?n.clone(t):{},t.parse===void 0&&(t.parse=!0);var i=t.success;return t.success=function(n,t,r){if(!n.set(n.parse(t,r),r))return!1;i&&i(n,t,r)},this.sync("read",this,t)},save:function(t,i,r){var u,f,e,s,o=this.attributes;return(t==null||typeof t=="object"?(u=t,r=i):(u={})[t]=i,u&&(!r||!r.wait)&&!this.set(u,r))?!1:(r=n.extend({validate:!0},r),!this._validate(u,r))?!1:(u&&r.wait&&(this.attributes=n.extend({},o,u)),r.parse===void 0&&(r.parse=!0),f=r.success,r.success=function(t,i,r){t.attributes=o;var e=t.parse(i,r);if(r.wait&&(e=n.extend(u||{},e)),n.isObject(e)&&!t.set(e,r))return!1;f&&f(t,i,r)},e=this.isNew()?"create":r.patch?"patch":"update",e==="patch"&&(r.attrs=u),s=this.sync(e,this,r),u&&r.wait&&(this.attributes=o),s)},destroy:function(t){var f;t=t?n.clone(t):{};var i=this,r=t.success,u=function(){i.trigger("destroy",i,i.collection,t)};return(t.success=function(n,t,i){(i.wait||n.isNew())&&u(),r&&r(n,t,i)},this.isNew())?(t.success(this,null,t),!1):(f=this.sync("delete",this,t),t.wait||u(),f)},url:function(){var t=n.result(this,"urlRoot")||n.result(this.collection,"url")||h();return this.isNew()?t:t+(t.charAt(t.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(n){return n},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(n){return!this.validate||!this.validate(this.attributes,n)},_validate:function(t,i){if(!i.validate||!this.validate)return!0;t=n.extend({},this.attributes,t);var r=this.validationError=this.validate(t,i)||null;return r?(this.trigger("invalid",this,r,i||{}),!1):!0}}),e=t.Collection=function(t,i){i||(i={}),i.model&&(this.model=i.model),i.comparator!==void 0&&(this.comparator=i.comparator),this.models=[],this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,n.extend({silent:!0},i))},n.extend(e.prototype,i,{model:f,initialize:function(){},toJSON:function(n){return this.map(function(t){return t.toJSON(n)})},sync:function(){return t.sync.apply(this,arguments)},add:function(t,i){t=n.isArray(t)?t.slice():[t],i||(i={});var u,o,r,s,c,e,f,h,l,a;for(f=[],h=i.at,l=this.comparator&&h==null&&i.sort!=!1,a=n.isString(this.comparator)?this.comparator:null,u=0,o=t.length;u<o;u++){if(!(r=this._prepareModel(s=t[u],i))){this.trigger("invalid",this,s,i);continue}if(c=this.get(r)){i.merge&&(c.set(s===r?r.attributes:s,i),l&&!e&&c.hasChanged(a)&&(e=!0));continue}f.push(r);r.on("all",this._onModelEvent,this);this._byId[r.cid]=r,r.id!=null&&(this._byId[r.id]=r)}if(f.length&&(l&&(e=!0),this.length+=f.length,h!=null?tt.apply(this.models,[h,0].concat(f)):nt.apply(this.models,f)),e&&this.sort({silent:!0}),i.silent)return this;for(u=0,o=f.length;u<o;u++)(r=f[u]).trigger("add",r,this,i);return e&&this.trigger("sort",this,i),this},remove:function(t,i){t=n.isArray(t)?t.slice():[t],i||(i={});for(var f,r,u=0,e=t.length;u<e;u++)(r=this.get(t[u]),r)&&(delete this._byId[r.id],delete this._byId[r.cid],f=this.indexOf(r),this.models.splice(f,1),this.length--,i.silent||(i.index=f,r.trigger("remove",r,this,i)),this._removeReference(r));return this},push:function(t,i){return t=this._prepareModel(t,i),this.add(t,n.extend({at:this.length},i)),t},pop:function(n){var t=this.at(this.length-1);return this.remove(t,n),t},unshift:function(t,i){return t=this._prepareModel(t,i),this.add(t,n.extend({at:0},i)),t},shift:function(n){var t=this.at(0);return this.remove(t,n),t},slice:function(n,t){return this.models.slice(n,t)},get:function(n){if(n!=null)return this._idAttr||(this._idAttr=this.model.prototype.idAttribute),this._byId[n.id||n.cid||n[this._idAttr]||n]},at:function(n){return this.models[n]},where:function(t){return n.isEmpty(t)?[]:this.filter(function(n){for(var i in t)if(t[i]!==n.get(i))return!1;return!0})},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return n.invoke(this.models,"get",t)},update:function(t,i){i=n.extend({add:!0,merge:!0,remove:!0},i),i.parse&&(t=this.parse(t,i));var u,r,e,f,o=[],s=[],h={};if(n.isArray(t)||(t=t?[t]:[]),i.add&&!i.remove)return this.add(t,i);for(r=0,e=t.length;r<e;r++)u=t[r],f=this.get(u),i.remove&&f&&(h[f.cid]=!0),(i.add&&!f||i.merge&&f)&&o.push(u);if(i.remove)for(r=0,e=this.models.length;r<e;r++)u=this.models[r],h[u.cid]||s.push(u);return s.length&&this.remove(s,i),o.length&&this.add(o,i),this},reset:function(t,i){i||(i={}),i.parse&&(t=this.parse(t,i));for(var r=0,u=this.models.length;r<u;r++)this._removeReference(this.models[r]);return i.previousModels=this.models.slice(),this._reset(),t&&this.add(t,n.extend({silent:!0},i)),i.silent||this.trigger("reset",this,i),this},fetch:function(t){t=t?n.clone(t):{},t.parse===void 0&&(t.parse=!0);var i=t.success;return t.success=function(n,t,r){var u=r.update?"update":"reset";n[u](t,r),i&&i(n,t,r)},this.sync("read",this,t)},create:function(t,i){if(i=i?n.clone(i):{},!(t=this._prepareModel(t,i)))return!1;i.wait||this.add(t,i);var u=this,r=i.success;return i.success=function(n,t,i){i.wait&&u.add(n,i),r&&r(n,t,i)},t.save(null,i),t},parse:function(n){return n},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models.length=0,this._byId={}},_prepareModel:function(n,t){if(n instanceof f)return n.collection||(n.collection=this),n;t||(t={}),t.collection=this;var i=new this.model(n,t);return i._validate(n,t)?i:!1},_removeReference:function(n){this===n.collection&&delete n.collection,n.off("all",this._onModelEvent,this)},_onModelEvent:function(n,t,i,r){(n!=="add"&&n!=="remove"||i===this)&&(n==="destroy"&&this.remove(t,r),t&&n==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))},sortedIndex:function(t,i,r){i||(i=this.comparator);var u=n.isFunction(i)?i:function(n){return n.get(i)};return n.sortedIndex(this.models,t,u,r)}}),v=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"],n.each(v,function(t){e.prototype[t]=function(){var i=c.call(arguments);return i.unshift(this.models),n[t].apply(n,i)}}),y=["groupBy","countBy","sortBy"],n.each(y,function(t){e.prototype[t]=function(i,r){var u=n.isFunction(i)?i:function(n){return n.get(i)};return n[t](this.models,u,r)}});var p=t.Router=function(n){n||(n={}),n.routes&&(this.routes=n.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},it=/\((.*?)\)/g,rt=/(\(\?)?:\w+/g,ut=/\*\w+/g,ft=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(p.prototype,i,{initialize:function(){},route:function(i,r,u){return n.isRegExp(i)||(i=this._routeToRegExp(i)),u||(u=this[r]),t.history.route(i,n.bind(function(n){var f=this._extractParameters(i,n);u&&u.apply(this,f),this.trigger.apply(this,["route:"+r].concat(f)),this.trigger("route",r,f),t.history.trigger("route",this,r,f)},this)),this},navigate:function(n,i){return t.history.navigate(n,i),this},_bindRoutes:function(){if(this.routes)for(var t,i=n.keys(this.routes);(t=i.pop())!=null;)this.route(t,this.routes[t])},_routeToRegExp:function(n){return n=n.replace(ft,"\\$&").replace(it,"(?:$1)?").replace(rt,function(n,t){return t?n:"([^/]+)"}).replace(ut,"(.*?)"),new RegExp("^"+n+"$")},_extractParameters:function(n,t){return n.exec(t).slice(1)}});var r=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},w=/^[#\/]|\s+$/g,et=/^\/+|\/+$/g,ot=/msie [\w.]+/,st=/\/$/;r.started=!1,n.extend(r.prototype,i,{interval:50,getHash:function(n){var t=(n||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(n,t){if(n==null)if(this._hasPushState||!this._wantsHashChange||t){n=this.location.pathname;var i=this.root.replace(st,"");n.indexOf(i)||(n=n.substr(i.length))}else n=this.getHash();return n.replace(w,"")},start:function(i){var u,f;if(r.started)throw new Error("Backbone.history has already been started");r.started=!0,this.options=n.extend({},{root:"/"},this.options,i),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment(),o=document.documentMode,s=ot.exec(navigator.userAgent.toLowerCase())&&(!o||o<=7);if(this.root=("/"+this.root+"/").replace(et,"/"),s&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState)t.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&"onhashchange"in window&&!s)t.$(window).on("hashchange",this.checkUrl);else this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));return(this.fragment=e,u=this.location,f=u.pathname.replace(/[^\/]$/,"$&/")===this.root,this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!f)?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&f&&u.hash&&(this.fragment=this.getHash().replace(w,""),this.history.replaceState({},document.title,this.root+this.fragment+u.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),r.started=!1},route:function(n,t){this.handlers.unshift({route:n,callback:t})},checkUrl:function(){var n=this.getFragment();if(n===this.fragment&&this.iframe&&(n=this.getFragment(this.getHash(this.iframe))),n===this.fragment)return!1;this.iframe&&this.navigate(n),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(t){var i=this.fragment=this.getFragment(t);return n.any(this.handlers,function(n){if(n.route.test(i))return n.callback(i),!0})},navigate:function(n,t){if(!r.started)return!1;if(t&&t!==!0||(t={trigger:t}),n=this.getFragment(n||""),this.fragment!==n){this.fragment=n;var i=this.root+n;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else if(this._wantsHashChange)this._updateHash(this.location,n,t.replace),this.iframe&&n!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace));else return this.location.assign(i);t.trigger&&this.loadUrl(n)}},_updateHash:function(n,t,i){if(i){var r=n.href.replace(/(javascript:|#).*$/,"");n.replace(r+"#"+t)}else n.hash="#"+t}}),t.history=new r;var b=t.View=function(t){this.cid=n.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},ht=/^(\S+)\s*(.*)$/,ct=["model","collection","el","id","attributes","className","tagName","events"];n.extend(b.prototype,i,{tagName:"div",$:function(n){return this.$el.find(n)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(n,i){return this.$el&&this.undelegateEvents(),this.$el=n instanceof t.$?n:t.$(n),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(t){var r,i;if(t||(t=n.result(this,"events"))){this.undelegateEvents();for(r in t){if(i=t[r],n.isFunction(i)||(i=this[t[r]]),!i)throw new Error('Method "'+t[r]+'" does not exist');var f=r.match(ht),u=f[1],e=f[2];if(i=n.bind(i,this),u+=".delegateEvents"+this.cid,e==="")this.$el.on(u,i);else this.$el.on(u,e,i)}}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(t){this.options&&(t=n.extend({},n.result(this,"options"),t)),n.extend(this,n.pick(t,ct)),this.options=t},_ensureElement:function(){var i,r;this.el?this.setElement(n.result(this,"el"),!1):(i=n.extend({},n.result(this,"attributes")),this.id&&(i.id=n.result(this,"id")),this.className&&(i["class"]=n.result(this,"className")),r=t.$("<"+n.result(this,"tagName")+">").attr(i),this.setElement(r,!1))}}),k={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"},t.sync=function(i,r,u){var e=k[i],f,o,s,c,l;return n.defaults(u||(u={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON}),f={type:e,dataType:"json"},u.url||(f.url=n.result(r,"url")||h()),u.data==null&&r&&(i==="create"||i==="update"||i==="patch")&&(f.contentType="application/json",f.data=JSON.stringify(u.attrs||r.toJSON(u))),u.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{}),u.emulateHTTP&&(e==="PUT"||e==="DELETE"||e==="PATCH")&&(f.type="POST",u.emulateJSON&&(f.data._method=e),o=u.beforeSend,u.beforeSend=function(n){return n.setRequestHeader("X-HTTP-Method-Override",e),o?o.apply(this,arguments):void 0}),f.type==="GET"||u.emulateJSON||(f.processData=!1),s=u.success,u.success=function(n){s&&s(r,n,u),r.trigger("sync",r,n,u)},c=u.error,u.error=function(n){c&&c(r,n,u),r.trigger("error",r,n,u)},l=u.xhr=t.ajax(n.extend(f,u)),r.trigger("request",r,l,u),l},t.ajax=function(){return t.$.ajax.apply(t.$,arguments)},d=function(t,i){var u=this,r,f;return r=t&&n.has(t,"constructor")?t.constructor:function(){return u.apply(this,arguments)},n.extend(r,u,i),f=function(){this.constructor=r},f.prototype=u.prototype,r.prototype=new f,t&&n.extend(r.prototype,t),r.__super__=u.prototype,r},f.extend=e.extend=p.extend=b.extend=r.extend=d,h=function(){throw new Error('A "url" property or function must be specified');}}).call(this);
//@ sourceMappingURL=backbone.min.js.map